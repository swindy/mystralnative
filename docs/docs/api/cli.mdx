# CLI Commands

Complete reference for the Mystral Native.js command-line interface.

## Overview

```
mystral <command> [options]

Commands:
  run <script>      Run a JavaScript/TypeScript file
  compile <entry>   Bundle into a single executable
  --version         Show version
  --help            Show help
```

## mystral run

Run a JavaScript or TypeScript file with WebGPU support.

```bash
mystral run <script.js> [options]
```

### Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `--width` | number | 1280 | Window width in pixels |
| `--height` | number | 720 | Window height in pixels |
| `--title` | string | "Mystral" | Window title |
| `--headless` | flag | - | Run without displaying a window |
| `--no-sdl` | flag | - | Run without SDL (headless GPU, no window system) |
| `--watch`, `-w` | flag | - | Watch mode: auto-reload on file changes |
| `--screenshot` | string | - | Take screenshot and exit |
| `--frames` | number | 60 | Frames to render before screenshot |
| `--quiet`, `-q` | flag | - | Suppress all output except errors |
| `--debug` | flag | - | Enable verbose WebGPU/shader debug logging |
| `--debug-port` | number | - | Enable debug server on specified port (for testing) |

### Video Recording Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `--video`, `--record` | string | - | Record video to file (WebP or MP4) |
| `--start-frame` | number | 0 | First frame to capture |
| `--end-frame` | number | - | Last frame to capture (required for video) |
| `--video-fps` | number | 60 | Video framerate |
| `--video-quality` | number | 80 | WebP quality 0-100 (higher = better) |
| `--mp4` | flag | - | Convert to MP4 (requires `ffmpeg` on PATH, auto-detected if path ends in .mp4) |

### Examples

```bash
# Basic usage
mystral run game.js

# Custom window size
mystral run game.js --width 1920 --height 1080

# Custom title
mystral run game.js --title "My Game"

# Headless rendering
mystral run game.js --headless

# Take screenshot for CI testing
mystral run game.js --headless --screenshot output.png --frames 120

# Record 5 seconds of video (300 frames at 60fps)
mystral run game.js --headless --video demo.webp --end-frame 300

# Record video with MP4 output (requires FFmpeg)
mystral run game.js --headless --video demo.mp4 --end-frame 600

# Enable verbose debug logging
mystral run game.js --debug
```

## mystral compile

Bundle a game into a single distributable executable.

```bash
mystral compile <entry.js> [options]
```

### Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `--output`, `--out`, `-o` | string | `./<entry-stem>` | Output file path |
| `--include`, `--assets` | string | - | Asset directory to bundle (repeatable) |
| `--root` | string | cwd | Root directory for bundle paths |
| `--bundle-only` | flag | - | Create standalone `.bundle` file instead of executable |

### Examples

```bash
# Compile into a standalone binary
mystral compile game.js --include assets --out dist/my-game
./dist/my-game

# Include multiple asset directories
mystral compile game.js --include assets --include sounds --out dist/my-game

# Create a .bundle file for macOS .app packaging
mystral compile game.js --include assets --bundle-only --out dist/game.bundle
```

### Bundle Mode

The `--bundle-only` flag creates a standalone `.bundle` file containing your JS entry point and assets, without copying the runtime executable. This is used for macOS `.app` packaging where the clean Mach-O binary needs to be code-signed separately:

```bash
# 1. Create the bundle
mystral compile game.js --include assets --bundle-only --out build/game.bundle

# 2. Package as macOS .app (using package-app.sh)
./scripts/package-app.sh \
    --binary build/mystral \
    --name "My Game" \
    --bundle build/game.bundle \
    --output dist
```

At runtime, the binary auto-detects `game.bundle` next to the executable, in `../Resources/` (macOS `.app`), or via the `MYSTRAL_BUNDLE` environment variable.

## Global Options

These options work with any command:

| Option | Description |
|--------|-------------|
| `--version`, `-v` | Print version and exit |
| `--help`, `-h` | Print help message |

## Exit Codes

| Code | Meaning |
|------|---------|
| 0 | Success |
| 1 | Script error or runtime error |
| 137 | Audio shutdown (macOS known issue) |

## Environment Variables

| Variable | Description |
|----------|-------------|
| `MYSTRAL_DEBUG` | Enable debug logging |
| `MYSTRAL_ASSET_PATH` | Override default asset search path |
| `MYSTRAL_BUNDLE` | Path to an external `.bundle` file to load |
| `MYSTRAL_HEADLESS` | Set to `1` to force headless mode |
| `V8_FLAGS` | V8 engine flags (e.g., `--max-old-space-size=4096`) |

## File Types

Mystral Native.js supports:

- `.js` - JavaScript (ES2024)
- `.ts` - TypeScript (transpiled via SWC)
- `.mjs` - ES modules
- `.mts` - TypeScript ES modules

## Next Steps

- [JavaScript APIs](/mystralnative/docs/api/javascript) - Supported Web APIs
- [Running Games](/mystralnative/docs/guides/running-games) - Usage guide
